<!DOCTYPE html>
<html lang="en">

<head>
    <title>Schmoney</title>
    <meta name="comp1800 template" content="My 1800 App">

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-------------------------------------------------------->
    <!-- Firebase 8 Library related CSS, JS, JQuery go here -->
    <!-------------------------------------------------------->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.css" />
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    
    <!-- Bootstrap Library CSS CDN go here -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Boostrap Library JS CDN  go here -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <!-- Other libraries go here -->
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <!-- Link to styles of your own -->
    <link rel="stylesheet" href="./styles/style.css">

</head>

<body>

    <!------------------------------>
    <!-- Your HTML Layout go here -->
    <!------------------------------>

      <!-- our own navbar goes here -->
      <nav id="navbarPlaceholder" class="navbar navbar-expand-lg bg-success-subtle">
      </nav>
      
      <!-- navbar placeholder -->
  

      <div class="container mt-5">
        <div class="row">
          <div class="col">
            <h2 class="mb-4">Budget</h2>
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>Category</th>
                  <th>Item</th>
                  <th>Cost ($)</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <!-- Sample row for cloning -->
                <tr class="template-row" style="display:none;">
                  <td></td>
                  <td></td>
                  <td></td>
                  <td>
                    <button class="btn btn-primary btn-edit" data-toggle="modal" data-target="#editModal"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-danger btn-delete"><i class="fas fa-trash-alt"></i></button>
                  </td>
                </tr>
              </tbody>
            </table>
            <button class="btn btn-success float-right mb-3" id="btn-add">Add</button>
          </div>
        </div>
      </div>
      
      <!-- Modal for editing -->
      <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="editModalLabel">Add/Edit Row</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="form-group">
                <label for="editCategory">Category:</label>
                <select class="form-control" id="editCategory">
                  <option value="Housing">Housing</option>
                  <option value="Entertainment">Entertainment</option>
                  <option value="Groceries">Groceries</option>
                  <option value="Personal Essentials">Personal Essentials</option>
                  <option value="Misc.">Misc.</option>
                </select>
              </div>
              <div class="form-group">
                <label for="editName">Item:</label>
                <input type="text" class="form-control" id="editName">
              </div>
              <div class="form-group">
                <label for="editPrice">Cost ($):</label>
                <input type="text" class="form-control" id="editPrice">
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary" id="btn-save">Save</button>
            </div>
          </div>
        </div>
      </div>

        <!-- Footer -->
        <footer class="text-center text-white fixed-bottom" style="background-color: #D1E7DD;">
          <!-- Grid container -->
          <div class="container p-4 pb-0">
            <!-- Section: CTA -->
            <section class="">
              <p class="d-flex justify-content-center align-items-center">
                <span class="me-3">Register for free</span>
                <button type="button" class="btn btn-outline-light btn-rounded">
                  Sign up!
                </button>
              </p>
            </section>
            <!-- Section: CTA -->
          </div>
          <!-- Grid container -->
      
          <!-- Copyright -->
          <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
            Â© 2023 Copyright:
            <a class="text-white" href="">Schmoney</a>
          </div>
          <!-- Copyright -->
        </footer>
        <!-- Footer -->


    <!------------------------------>
    <!-- Your HTML Layout go here -->
    <!------------------------------>

    <!-- our own navbar goes here -->
    <!-- <nav id="navbarPlaceholder"></nav> -->

    <!-- the body of your page goes here -->
    <!-- stuff -->

    <!-- our own footer goes here-->
    <!-- <nav id="footerPlaceholder"></nav> -->

    <!---------------------------------------------->
    <!-- Your own JavaScript functions go here    -->
    <!---------------------------------------------->
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script>
    // Your Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyDQUVrdoCBnEZ5kItasgtodHAl9sAAMqiQ",
        authDomain:  "bby-21-schmoney.firebaseapp.com",
        projectId:  "bby-21-schmoney",
        storageBucket: "bby-21-schmoney.appspot.com",
        messagingSenderId: "588767541894",
        appId: "1:588767541894:web:e3b523165d90ae1e096f07"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
</script>

<!-- Load jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Load Bootstrap JS -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- Load your custom scripts -->
<script src="./scripts/script.js"></script>
<script src="./scripts/firebaseAPI_BBY21.js"></script>
<script src="./scripts/skeleton.js"></script>

<script>
  $(document).ready(function() {
    // Add button click event
    $('#btn-add').click(function() {
      $('#editModal').data('row', null).modal('show');
    });
  
    // Save button click event in modal
    $('#btn-save').click(function() {
      var $modal = $('#editModal');
      var $row = $modal.data('row');
      var $inputs = $modal.find('.form-control');
      
      // Create a new row if not editing an existing one
      if (!$row) {
        var $template = $('.template-row').clone().removeClass('template-row').removeAttr('style');
        $row = $template.appendTo('tbody');
      }
  
      // Update row with input values
      $inputs.each(function(index) {
        $row.find('td:eq(' + index + ')').text($(this).val());
      });

      // Saves data to Firestore
      var category = $inputs.eq(0).val();
      var item = $inputs.eq(1).val();
      var cost = parseFloat($inputs.eq(2).val());

      // Adds data to Firebase collection "budget"
      db.collection("budget").add({
          category: category,
          item: item,
          cost: cost
      })
      .then(function(docRef) {
          console.log("Document written with ID: ", docRef.id);
          // Close modal and reset form
          $modal.modal('hide');
          $inputs.val('');
      })
      .catch(function(error) {
          console.error("Error adding document: ", error);
          // Optionally, display an error message to the user
      });
    });
  
    // Edit button click event (for dynamically added rows)
    $(document).on('click', '.btn-edit', function() {
      var $row = $(this).closest('tr');
      var $modal = $('#editModal');
      var $inputs = $modal.find('.form-control');
      
      // Populate modal inputs with row values
      $inputs.each(function(index) {
        $(this).val($row.find('td:eq(' + index + ')').text());
      });
      
      // Store row reference in modal
      $modal.data('row', $row).modal('show');
    });
  
    // Delete button click event (for dynamically added rows)
    $(document).on('click', '.btn-delete', function() {
      $(this).closest('tr').remove();
    });
  
    // Handle modal close event
    $('#editModal').on('hidden.bs.modal', function () {
      console.log("Modal closed!");
      var $inputs = $(this).find('.form-control');
      // Reset form on modal close
      $inputs.val('');
    });
  });
</script>




<!-- Remove commented-out code if not needed -->
<!-- <script>
  // logout();       //make sure user is logged out
</script> -->

</body>

</html>
